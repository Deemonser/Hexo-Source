---
title: 第三方登录
date: 2017-03-12 16:13:49
categories: Android记录
tags: 
 - 第三方登录
---

### 前言

最近， 老大说要接入第三方登录，想想感觉挺简单的，最简单的方法莫过于集成友盟的社会化SDK，在一阵嘴遁过后， 我发现，我想多了......

<!-- more -->

### 分析

现在我先分析分析：

1. **第三方登录目的**
   第三方登录的目的很简单，就是利用用户在其他平台上频繁使用的账号，来快速登录你的产品，达到不注册就登录的目的。
2. **第三方登录好处**
   第三方登录的好处，显而易见。
   不需要注册账号，直接使用已有的QQ号、微信等登录。减少了注册环节，减少了因为注册而流失的用户。
   可以直接获取用户昵称、头像等信息，省去再次填写昵称、上传头像的麻烦。
   共享QQ、微信等账号已有的用户关系，用户进入产品中就能找到熟悉的人，容易留住用户。
   多数情况下，还减少了登录时账号和密码输入，通过点击就完成了登录

**然而，不是所有类型的应用是适用第三方登录。**



### 使用场景

1. 一般来说，对于工具型、游戏型、内容型等应用，注重的是工具的使用、内容的提供，适合把第三方登录放在优先的位置，甚至只提供第三方登录就行，免去用户注册。如下图：
   ![工具型、游戏型、内容型应用](http://upload-images.jianshu.io/upload_images/2169865-25d0d28783c6d1fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
2. 对于电商类应用，注重自己账号体系的建立、注重用户后续的营销，第三方登录只是作为补充，将第三方登录置于较弱的位置，为新没有账号的用户提供快速登录。如下图：
   ![电商类应用](http://upload-images.jianshu.io/upload_images/2169865-dee1659dc55b15cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
3. 对于支付类、金融类应用，强调安全性、强调隐私性，一般不提供第三方登录。如果这些类型应用提供第三方登录，让用户觉得不安全，感觉自己的信息会通过第三方授权泄露出去。如下图：
   ![互联网金融类应用](http://upload-images.jianshu.io/upload_images/2169865-b3780326bf18f0e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
   看看你的应用属于什么类型，是不是合适第三方登录，第三方登录应该置于什么样的权重下。



### 问题

**恰好，我不幸躺枪......**
集成过友盟的第三方登录的都应该看过文档，友盟把各大平台的第三方登录集成在一起，方便了我们的同时，也暴露了一些问题。
就拿微信来说，只要配置好AppID和AppSecret就可以直接拿到了accesstoken,openid,unionid等。
unionid是用户在微信的唯一标识（公司多平台共用），我想后台也一定是拿这个unionid做用户关系映射的。难道我就这么直接拿到unionid后扔给后台完成登录？我不死心的问了同行的朋友，得到的结果是，他们确实这样做的。原因很简单，他们是内容型应用.......（好吧，当我没问）

**如果非要使用择怎么办呢？**
首先了解下第三方登录的原理[OAuth2.0](http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)
OAuth2.0有四种模式，而常用的就是授权码模式（完整流程），各大平台提供的第三方登录，我想在他们把数据给到自己之前都不需要都不用考虑他们的安全性问题（他们都不靠谱就没办法啦...）。

详细的流程图
![新浪微博登录流程.jpg](http://upload-images.jianshu.io/upload_images/2169865-bc0ab3692699bedd.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

如果是普通应用，拿到unionid后通过post请求登录这没问题，但注重安全的应用不行。unionid在其他应用上也能拿到，如果这么直接交给后台肯定不行。

所以，我首先想到一个方案是对拿到的unionid进行RSA加密，再传给后台，后台校验解密后匹配登录。这个方案的好处就是简单，只需要集成友盟，所有平台都搞定了。
还有第二种方案，查看微信文档发现，如果独自集成微信是安全的，原因是微信登录第一步接口返回的只有一个code，这个code有10min时效而且只能用一次。那么我们将这个code发给后台，让后台请求accesstoken就行啦.这种方案是挺安全的，但是需要后台的支持，后台相对麻烦一点。